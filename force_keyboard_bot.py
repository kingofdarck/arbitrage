#!/usr/bin/env python3
"""
–ë–æ—Ç —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø—Ä–∏ –ö–ê–ñ–î–û–ú —Å–æ–æ–±—â–µ–Ω–∏–∏
"""

import logging
import asyncio
from telegram import Update, ReplyKeyboardMarkup, KeyboardButton, ReplyKeyboardRemove
from telegram.ext import Application, MessageHandler, ContextTypes, filters

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

TOKEN = '8565304713:AAFpnuNkp4QR6Yk9H-5NoN8l3Z1pN2WigKQ'

def create_keyboard():
    """–°–æ–∑–¥–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É"""
    keyboard = [
        [KeyboardButton("üìä –°—Ç–∞—Ç—É—Å"), KeyboardButton("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")],
        [KeyboardButton("‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫"), KeyboardButton("‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞")],
        [KeyboardButton("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫"), KeyboardButton("üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")]
    ]
    return ReplyKeyboardMarkup(
        keyboard, 
        resize_keyboard=True,
        one_time_keyboard=False,
        is_persistent=True
    )

async def force_send_keyboard(update: Update, text: str):
    """–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã"""
    keyboard = create_keyboard()
    
    try:
        # –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
        await update.message.reply_text("‚å®Ô∏è", reply_markup=ReplyKeyboardRemove())
        await asyncio.sleep(0.1)  # –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        
        # –ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é
        await update.message.reply_text(text, reply_markup=keyboard)
        logger.info("‚úÖ –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞")
        return True
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã: {e}")
        # –ü—Ä–æ–±—É–µ–º –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        try:
            await update.message.reply_text(text, reply_markup=keyboard)
            return True
        except Exception as e2:
            logger.error(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e2}")
            return False

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    text = update.message.text
    user_id = update.effective_user.id
    
    logger.info(f"üì® –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {user_id}: '{text}'")
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Ç–≤–µ—Ç
    responses = {
        "üìä –°—Ç–∞—Ç—É—Å": """üìä –°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´

üü¢ –ë–æ—Ç: –ê–∫—Ç–∏–≤–µ–Ω
üåê –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: Railway
üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: –ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É
üíß –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –í–∫–ª—é—á–µ–Ω—ã

‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!""",

        "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏": """‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò –°–ò–°–¢–ï–ú–´

‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å: 0.75%
‚Ä¢ –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏: 5 —Å–µ–∫—É–Ω–¥
‚Ä¢ –ú–µ–∂–±–∏—Ä–∂–µ–≤–æ–π –∞—Ä–±–∏—Ç—Ä–∞–∂: ‚úÖ
‚Ä¢ –¢—Ä–µ—É–≥–æ–ª—å–Ω—ã–π –∞—Ä–±–∏—Ç—Ä–∞–∂: ‚úÖ
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏: ‚úÖ
‚Ä¢ –ë–∏—Ä–∂–∏: 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö

‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!""",

        "‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫": """‚ñ∂Ô∏è –ú–û–ù–ò–¢–û–†–ò–ù–ì –ó–ê–ü–£–©–ï–ù!

üöÄ –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
üîç –ü–æ–∏—Å–∫ –∞—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
üìä –ê–Ω–∞–ª–∏–∑ 6000+ —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä
üíß –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–Ω–∞
üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å—é–¥–∞

‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!""",

        "‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞": """‚èπÔ∏è –ú–û–ù–ò–¢–û–†–ò–ù–ì –û–°–¢–ê–ù–û–í–õ–ï–ù!

üõë –ü–æ–∏—Å–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
üì¥ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã
üí§ –°–∏—Å—Ç–µ–º–∞ –≤ —Ä–µ–∂–∏–º–µ –æ–∂–∏–¥–∞–Ω–∏—è
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!""",

        "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫": """üîÑ –°–ò–°–¢–ï–ú–ê –ü–ï–†–ï–ó–ê–ü–£–©–ï–ù–ê!

‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
üöÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞
‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!""",

        "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞": """üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –†–ê–ë–û–¢–´

‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: –û–Ω–ª–∞–π–Ω
üîÑ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ü–∏–∫–ª–æ–≤: 1,543
üéØ –ù–∞–π–¥–µ–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π: 127
üì± –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: 34
üíß –ü—Ä–æ–≤–µ—Ä–æ–∫ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏: 289
‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö –∞—Ä–±–∏—Ç—Ä–∞–∂–µ–π: 78%

‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!"""
    }
    
    # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
    if text in responses:
        response = responses[text]
    else:
        response = f"""‚ùì –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: "{text}"

ü§ñ –ê—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä –∞–∫—Ç–∏–≤–µ–Ω!

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞:
üìä –°—Ç–∞—Ç—É—Å - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ - —Å—Ç–∞—Ä—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ - —Å—Ç–æ–ø –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –¥–∞–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!"""
    
    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
    success = await force_send_keyboard(update, response)
    
    if success:
        logger.info(f"‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
    else:
        logger.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")

async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫"""
    logger.error(f"‚ùå –û—à–∏–±–∫–∞: {context.error}")
    
    if update and update.message:
        try:
            await force_send_keyboard(
                update, 
                f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {context.error}\n\nüîÑ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞"
            )
        except Exception as e:
            logger.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ: {e}")

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    logger.info("ü§ñ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π...")
    
    app = Application.builder().token(TOKEN).build()
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    app.add_handler(MessageHandler(filters.TEXT, handle_message))
    app.add_error_handler(error_handler)
    
    print("ü§ñ –ë–æ—Ç —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π –∑–∞–ø—É—â–µ–Ω!")
    print("‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏")
    print("üì± –ö–Ω–æ–ø–∫–∏: –°—Ç–∞—Ç—É—Å, –ù–∞—Å—Ç—Ä–æ–π–∫–∏, –ó–∞–ø—É—Å–∫, –û—Å—Ç–∞–Ω–æ–≤–∫–∞, –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫, –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é
    try:
        app.run_polling(
            drop_pending_updates=True,
            allowed_updates=Update.ALL_TYPES
        )
    except Exception as e:
        logger.error(f"üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: {e}")

if __name__ == "__main__":
    main()